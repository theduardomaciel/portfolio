---
import BaseLayout from "@layouts/BaseLayout.astro";
import BlogLayout from "@layouts/BlogLayout.astro";
import BlogHome from "@layouts/BlogHome.astro";

import Footer from "@components/Footer.astro";
import Header from "@components/Header/Header.astro";

import { getAllPostsWithCategory, getAllTags } from "src/lib/sanity/api";

const allTags = await getAllTags();

/* export async function getStaticPaths() {
    const allBlogPosts = await getAllPosts();
    const allTags = await getAllTags();

    return allTags.map((tag: PostTag) => {
        const filteredResponse = allBlogPosts.filter((post: any) => {
            const postTags = getTagsFromPost(allTags, post.categories);
            if (postTags.includes(tag)) {
                return { post: post };
            }
        });

        return {
            params: { slug: tag.title },
            props: { posts: filteredResponse },
        };
    });
}

const { posts } = Astro.props; */

const { category } = Astro.params;
const posts = (await getAllPostsWithCategory(category as string)) || [];

const seo = {
    title: "Blog",
    description: "The blog of my simple porfolio.",
};

export const prerender = false;
const { lang } = Astro.params;

---

<BaseLayout seo={seo}>
    <BlogLayout>
        <Header />
        <BlogHome posts={posts} tags={allTags} />
        <Footer />
    </BlogLayout>
</BaseLayout>
