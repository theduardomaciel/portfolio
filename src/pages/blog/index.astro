---
import Svg from "@jasikpark/astro-svg-loader";

import BaseLayout from "@layouts/BaseLayout.astro";
import "@styles/blog.css";

import Footer from "@components/Footer.astro";
import Header from "@components/Header/Header.astro";

import { getAllPosts, getAllTags } from "src/lib/sanity/api";
import PostPreview from "@components/PostPreview.astro";

import type { PostTag } from "src/lib/sanity/getTagsFromPost";
import getTagsFromPost from "src/lib/sanity/getTagsFromPost";

const tags = (await getAllTags()) as PostTag[];
const posts = await getAllPosts();

const seo = {
    title: "Blog",
    description: "The blog of my simple porfolio.",
};
---

<script>
    const scrolls = document.querySelectorAll(".scroller");
    scrolls.forEach((scroll) => {
        scroll.addEventListener("wheel", function (event: any) {
            console.log("scroll", event.deltaY);
            if (event.deltaY > 0) {
                scroll.scrollTo({
                    top: 0,
                    left: scroll.scrollLeft + 100,
                    behavior: "smooth",
                });
                event.preventDefault();
                // preventDefault() will help avoid worrisome
            } else {
                scroll.scrollTo({
                    top: 0,
                    left: scroll.scrollLeft - 100,
                    behavior: "smooth",
                });
                event.preventDefault();
            }
        });
    });
</script>

<BaseLayout seo={seo}>
    <Header />
    <main class="blog">
        <header class="wrapper">
            <h1>Blog</h1>
            <div class="readingListHolder"></div>
        </header>

        <nav>
            <div class="tagsHolder wrapper scroller">
                <ul class="tags">
                    <li class="tag">
                        View all
                        <div class="divisor"></div>
                    </li>
                    {
                        tags.map((tag: PostTag, index: number) => {
                            return (
                                <li class="tag">
                                    {tag.title}
                                    {index !== tags.length - 1 && (
                                        <div class="divisor" />
                                    )}
                                </li>
                            );
                        })
                    }
                </ul>
            </div>
            <div class="wrapper listButton">
                <a class="button" href="/blog/list">
                    <Svg
                        class="icon"
                        fill={"var(--primary-01)"}
                        src={import("@assets/icons/bookmark.svg?raw")}
                        aria-label="Bookmark icon"
                    />
                    My reading list
                </a>
            </div>
        </nav>

        <section class="posts wrapper">
            {
                posts.map((post: any) => {
                    const postTags = getTagsFromPost(tags, post.categories);

                    return <PostPreview post={post} tags={postTags} />;
                })
            }
        </section>
    </main>
    <Footer />
</BaseLayout>
